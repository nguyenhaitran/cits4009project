---
title: "CITS4009-Individual Project"
author: "Henry Tran"
date: "2024-10-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Install all the required packages
library(ggplot2)
library(shiny)
library(gridExtra)
library(reshape2)
```

```{r}
# Read the data
path<-url("https://lms.uwa.edu.au/bbcswebdav/pid-3998436-dt-content-rid-47695412_1/courses/CITS4009_SEM-2_2024/Countries%20and%20death%20causes.csv")
```

# Data Exploratory
```{r}
data<-read.csv(path, header=TRUE)
head(data)
nrow(data)
```
The data has 31 columns and 6840 rows. For the column names, they can be seen that the column names have dot-separated between each word.

```{r}
names(data)<-gsub("\\.", "_", names(data)) #remove the dot in the column names

data
```

```{r}
str(data)
```
```{r}
summary(data)
```
For the first 2 columns, "Entity" and "Code" store different country names and codes. Therefore, to set them as a country as a unique value, it would be the best to convert them into factor

```{r}
data$Entity<-as.factor(data$Entity)
data$Code<-as.factor(data$Code)

summary(data)
str(data)
```
There are 228 unique entities but there are only 206 codes in this dataset. The reason is because there are some countries and regions do not have unique codes.

While with remaining 29 columns, the maximum numbers are extremely larger than other values. The reason is because the dataset did not only record deaths of countries, but it also recorded the total deaths in groups, regions and in the world. Therefore, if we do the data analysis on the whole dataset, it will create skewness problem. The solution for this would be we can seperated data into different groups: countries, regions and world. I have some examples of the single eda below:

```{r}
boxplot(data$High_systolic_blood_pressure)
```
```{r}
boxplot(data$Outdoor_air_pollution)
```


For data exploratory, it will be done using Shiny app

```{r}
# Define UI for application that draws different plot
ui <- fluidPage(
    titlePanel("Histogram of death in country/region during 1990 - 2019"),
    selectInput("plot_type", "Select plot type:", choices = c("Line plot", "Heat map")),
    sidebarLayout(
        sidebarPanel(
            conditionalPanel(
              condition = "input.plot_type == 'Line plot'",
              checkboxInput("compare", "Compare between 2 countries/regions", FALSE),
            ),
            selectInput("region1", "Choose the first country/region:", choices = unique(data$Entity)),
            conditionalPanel(
              condition = "input.compare == true",
              selectInput("region2", "Choose the second country/region:", choices = unique(data$Entity))
            ),
            conditionalPanel(
              condition = "input.plot_type == 'Line plot'",
              selectInput("reason", "Choose death reason:", choices = names(data)[4:31])
            ),
        ),
        mainPanel(            
          plotOutput("plot1"),
            conditionalPanel(
                condition = "input.compare == true && input.plot_type == 'Line plot'",  # Display plot2 only if compare is checked
                plotOutput("plot2"))
        )
    )
)


# Define the server
server <- function(input, output){
    # Render the histograms
    output$plot1 <- renderPlot({
      region_data<-data[data$Entity==input$region1,]
      # Plot selected death reason
      if (input$plot_type == 'Line plot'){
      ggplot(region_data, aes_string(x="Year", y=input$reason)) + geom_line(color="darkorange") + labs(x="Year", y = input$reason)}
      # Plot the Heat Map for selected country
      else if (input$plot_type == 'Heat map'){
        data_melt <- melt(region_data, id.vars = "Year", measure.vars = names(data)[4:31], variable.name = "death_reason", value.name = "value")
        # Create heat map
        ggplot(data_melt, aes(x = Year, y = death_reason, fill = value)) + 
            geom_tile() + 
            scale_fill_gradient(low = "white", high = "blue") +
            scale_x_continuous(breaks = seq(1990, 2019, by = 2)) +
            labs(x = "Year", y = "Death Reason", title = paste("Heat Map of Death Reasons in", input$region1)) +
            theme_minimal() +
            theme(axis.text.x = element_text(angle = 45, hjust = 1))
      }
    })
    output$plot2 <- renderPlot({ 
      if (input$compare == TRUE && input$plot_type == 'Line plot'){
      region_data<-data[data$Entity==input$region2,]
      # Plot all death reasons
      ggplot(region_data, aes_string(x="Year", y=input$reason)) + geom_line(color="darkolivegreen") + labs(x="Year", y = input$reason)
    }
  })
}

# Run the Shiny app
shinyApp(ui = ui, server = server)
```
The data needs to be transformed, including divided the data into different groups, including countries, regions, and the world.

### some ideas of single variable EDA

### some ideas of multiple variables EDA:
 - facet line plot - show individual trend for each death reasons of each country
 - stacked bar chart - show the different number of deaths per years for a country 




